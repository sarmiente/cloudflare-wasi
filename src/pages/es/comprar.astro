---
import Layout from "../../layouts/Layout.astro";
import type { The0 } from '../../api/[id_property].json';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const urlSearch = "https://api.wasi.co/v1/property/search?";
const options = {
    method: "POST",
    headers: {
        "Content-Type": "application/json; charset=UTF-8",
        Authentication: `Bearer ${import.meta.env.PUBLIC_ID_COMPANY}`,
    }
};
const res = await fetch(`${urlSearch}id_company=${import.meta.env.PUBLIC_ID_COMPANY}&wasi_token=${import.meta.env.PUBLIC_WASI_TOKEN}&take=100&for_sale=true`, options);

const data = await res.json();
// @ts-ignore
const properties = Object.keys(data)
    .filter(key => key !== "total" && key !== "status")
// @ts-ignore
    .map(key => data[key]);

---

<script type="module" is:inline astro:page-load>
        // @ts-ignore
        var monkeyComprar = new List('property-list-comprar', {
        valueNames: ['title-comprar'],
        listClass: 'list-comprar',
        searchClass: 'search-comprar',
        page: 3,
        pagination: true
  });
  </script>

<Layout title="Properties for Sale">

    <section id="property-list-comprar" class="md:p-12  py-32 md:pt-48 bg-gray-100">
        <!-- Título del portafolio -->
        <h2 class="text-center text-xl md:text-3xl font-heading uppercase pt-10 pb-10">
          Our Properties for Sale
        </h2>
      
        <!-- Filtros y búsqueda -->
        <div class="mx-auto w-2/3 md:w-1/2 flex flex-col md:flex-row items-center justify-between gap-4 mb-8">
          <!-- Campo de búsqueda -->
          <input
            type="search"
            class="search-comprar w-full  border border-gray-300 rounded-lg p-2 text-xs focus:outline-none focus:ring focus:ring-green-500 font-pattern"
            placeholder="Search by title, property ID, or price"
          />
        </div>
      
        
          <!-- Contenedor de propiedades -->
          <div class="list-comprar grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 p-5 sm:p-8 ">
            <!-- Cada propiedad -->
            {properties.map((property: The0) => (
              <div class="rounded-lg overflow-hidden shadow-lg transform transition duration-300 hover:scale-105 hover:shadow-2xl border-x-3 border-main/70">
                <a href={translatePath(`/property/${property.id_property}`)} class="block">
                  <!-- Imagen de la propiedad -->
                  <div class="relative">
                    <picture>
                      <source type="image/avif" src={property.main_image.url_original} />
                      <img
                      loading="lazy"
                      decoding="async"
                      alt="Property Image"
                      src={property.main_image.url_original}
                      class="h-56 w-full object-cover"
                    />
                    </picture>
                    <!-- Etiqueta de ubicación -->
                    <div class="absolute top-2 right-2 bg-black bg-opacity-75 text-white text-xs px-3 py-1 rounded">
                      <p class="font-display uppercase">{property.city_label}</p>
                    </div>
                  </div>
          
                                                        <!-- Detalles de la propiedad -->
                  <div class="p-4 bg-white">
                                                        <!-- Título y precio -->
                    <div class="mb-4">
                      <h2 class="title-buy text-lg font-medium font-heading text-gray-800 uppercase truncate">
                        {property.title}
                      </h2>
                      <p class="text-sm text-gray-600 font-light font-display uppercase">
                          Selling price {property.sale_price_label}
                      </p>
                    </div>
                                                        <!-- Botón "View Property" -->
                    <div class="flex items-center justify-between mt-4">
                      <p class="text-xs text-gray-600 font-light font-display property-buy">
                        {property.id_property}
                      </p>
            
                                                        <!-- Botón "View Property" -->
                      <div class="w-1/2 flex justify-end">
                          <a
                            href={translatePath(`/property/${property.id_property}`)}
                            class="bg-main font-pattern uppercase p-2 text-xs rounded-md"
                          >
                            {t("view.btn")}
                          </a>
                      </div>
                    </div>        
                  </div>
                </a>
              </div>
            ))}
          </div>      
      
      
          <!-- Controles de paginación -->
        <div id="pagination-controls" class="text-center mt-8 ">
          <div class="inline-flex items-center justify-center gap-3">
            
          
            <ul class="pagination flex gap-4"></ul>
          
            
          </div>
        </div>
      </section>
</Layout>

